stages:
  - build
  - deploy

build_linux:
  stage: build
  only: [CI]
  tags: [docker-executor]
  image: microsoft/dotnet:sdk
  variables:
    PLATFORM: linux-x64
  script: 
    - export VERSION=$(cat .version)
    - cd src/App
    - dotnet publish -o oas -c Release -r $PLATFORM /property:Version=$VERSION
  artifacts:
    name: oas-$PLATFORM
    paths: [oas]

deploy_nuget:
  stage: deploy
  only: [CI]
  tags: [docker-executor]
  image: microsoft/dotnet:sdk
  script:
    - export VERSION=$(cat .version)
    - cd src/App
    - dotnet pack -o nuget -c Release /property:Version=$VERSION
    - dotnet nuget push nuget/*.nupkg -s http://nuget.itexpert.ru/nuget/ -k password