openapi: 3.0.0
info:
  version: 0.6.0
  title: Source
  description: Service for unified basic data access.
  contact:
    name: n.batrakov
    email: n.batrakov@itexpert.ru
servers:
    - url: /api/source
paths:
  /update:
    post:
      tags:
        - Commands
      summary: Modifies existing entity instance in source. Id must be specified.
      operationId: UpdatePost
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json-patch+json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/UpdateRequest'
        description: The request.
  /insert:
    post:
      tags:
        - Commands
      summary: Writes new entity instance in source.
      operationId: InsertPost
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/EntityInstance'
            application/json:
              schema:
                $ref: '#/components/schemas/EntityInstance'
            text/json:
              schema:
                $ref: '#/components/schemas/EntityInstance'
      requestBody:
        content:
          application/json-patch+json:
            schema:
              $ref: '#/components/schemas/InsertRequest'
          application/json:
            schema:
              $ref: '#/components/schemas/InsertRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/InsertRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/InsertRequest'
        description: The request.
  /delete:
    post:
      tags:
        - Commands
      summary: Removes existing entity instance in source. Id must be specified.
      operationId: DeleteDelete
      responses:
        '200':
          description: Success
      requestBody:
        content:
          application/json-patch+json:
            schema:
              $ref: '#/components/schemas/DeleteRequest'
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/DeleteRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/DeleteRequest'
        description: The request.
  /query:
    post:
      tags:
        - Queries
      summary: Queries entity in source and returns found objects.
      operationId: QueryPost
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/QueryResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/QueryResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/QueryResponse'
      requestBody:
        content:
          application/json-patch+json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
          application/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/QueryRequest'
        description: The request.
  /metadata:
    get:
      tags:
        - Queries
      summary: Returns entity metadata.
      operationId: MetadataGet
      parameters:
        - name: entity
          in: query
          description: Entity name.
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/GetMetadataResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/GetMetadataResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/GetMetadataResponse'
  /available:
    get:
      tags:
        - Queries
      summary: Returns entities available to current user.
      operationId: AvailableGet
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/GetAvailableEntitiesResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/GetAvailableEntitiesResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/GetAvailableEntitiesResponse'
  /count:
    post:
      tags:
        - Queries
      summary: Counts number of objects found in specified query
      operationId: CountPost
      responses:
        '200':
          description: Success
          content:
            text/plain:
              schema:
                $ref: '#/components/schemas/PrimitiveValueResponse'
            application/json:
              schema:
                $ref: '#/components/schemas/PrimitiveValueResponse'
            text/json:
              schema:
                $ref: '#/components/schemas/PrimitiveValueResponse'
      requestBody:
        content:
          application/json-patch+json:
            schema:
              $ref: '#/components/schemas/CountRequest'
          application/json:
            schema:
              $ref: '#/components/schemas/CountRequest'
          text/json:
            schema:
              $ref: '#/components/schemas/CountRequest'
          application/*+json:
            schema:
              $ref: '#/components/schemas/CountRequest'
        description: The request.

components:
  schemas:
    UpdateRequest:
      required:
        - entity
        - value
      type: object
      properties:
        entity:
          description: Entity name.
          type: string
        value:
          description: Entity instance to update.
          type: object
          additionalProperties:
            $ref: '#/components/schemas/IncomingEntityPropertyValue'
    IncomingEntityPropertyValue:
      type: object
      properties:
        type:
          description: Field type. Required only for fields with union types.
          type: string
        value:
          description: Field value.
          type: object
    InsertRequest:
      required:
        - entity
        - value
      type: object
      properties:
        entity:
          description: Entity name.
          type: string
        value:
          description: Entity instance to insert.
          type: object
          additionalProperties:
            $ref: '#/components/schemas/IncomingEntityPropertyValue'
    EntityInstance:
      type: object
      properties:
        properties:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/PropertyValue'
          readOnly: true
    PropertyValue:
      type: object
      properties:
        name:
          type: string
          readOnly: true
        value:
          type: object
          readOnly: true
    DeleteRequest:
      required:
        - entity
        - value
      type: object
      properties:
        entity:
          description: Entity name
          type: string
        value:
          description: Entity instance to delete
          type: object
          additionalProperties:
            $ref: '#/components/schemas/IncomingEntityPropertyValue'
    QueryRequest:
      required:
        - entity
      type: object
      properties:
        distinct:
          description: Determines whether only distinct objects should be returned.
          type: boolean
        entity:
          description: Entity name
          type: string
        fields:
          description: Fields names to return. Lesser the better.
          type: array
          items:
            type: string
        filter:
          $ref: '#/components/schemas/EntityFilter'
        limit:
          format: int32
          description: Number of objects to return.
          type: integer
        offset:
          format: int32
          description: Number of objects to skip.
          type: integer
        sort:
          description: Fields used for ordering.
          type: array
          items:
            $ref: '#/components/schemas/QuerySortField'
    EntityFilter:
      type: object
      properties:
        isLogicalNode:
          description: 'True if this node is logical, i.e. contains other nodes.'
          type: boolean
          readOnly: true
        isNegative:
          description: True if this node should be logically negated.
          type: boolean
        nodes:
          description: Filter child nodes. Only valid for logical nodes.
          type: array
          items:
            $ref: '#/components/schemas/EntityFilter'
        field:
          description: Entity field to compare with value. Only valid for comparison nodes.
          type: string
        operator:
          description: Comparison operator. Only valid for comparison nodes.
          type: string
        value:
          description: Value compared to instance field. Only valid for comparison nodes.
          type: object
    QuerySortField:
      type: object
      properties:
        field:
          description: Entity field name.
          type: string
        isAscending:
          description: True if sorting by the field should be ascending.
          type: boolean
    EntityPropertyValue:
      type: object
      properties:
        referenceName:
          description: >-
            Display name for the object referenced by this field; null for value
            types.
          type: string
          readOnly: true
        value:
          description: Field value.
          type: object
          readOnly: true
        type:
          description: Value type; present only for fields with union types.
          type: string
          readOnly: true
    MetadataResponseProperty:
      type: object
      properties:
        isNullable:
          description: True if field can be null.
          type: boolean
        class:
          description: >-
            Field type class [Primitive, Reference, Union, Collection,
            Enumeration].
          enum:
            - Primitive
            - Reference
            - Union
            - Collection
            - Enumeration
          type: string
        type:
          description: Field type name. Present for Primitive and Reference types.
          type: string
        reference:
          description: Name of entity referenced by the field. Present for Reference types.
          type: string
        id:
          description: >-
            String identifier for chosing one of possible types in Union type.
            Present only inside PossibleTypes property.
          type: string
        possibleTypes:
          description: All types the field value can be of. Present for Union types.
          type: array
          items:
            $ref: '#/components/schemas/MetadataResponseProperty'
        possibleValues:
          description: >-
            All values the field value can be equal to. Present for Enumeration
            types.
          type: array
          items:
            type: string
        itemsType:
          $ref: '#/components/schemas/MetadataResponseProperty'
    GetAvailableEntitiesResponse:
      type: object
      properties:
        entities:
          type: array
          items:
            $ref: '#/components/schemas/EntityName'
          readOnly: true
    EntityName:
      required:
        - name
      type: object
      properties:
        name:
          type: string
    CountRequest:
      required:
        - entity
      type: object
      properties:
        entity:
          description: Entity name.
          type: string
        filter:
          $ref: '#/components/schemas/EntityFilter'
    
    
    QueryResponse:
      type: object
      properties:
        entities:
          type: array
          items:
            type: object
            additionalProperties:
              $ref: '#/components/schemas/EntityPropertyValue'
          readOnly: true
      example:
        entities:
        - Ссылка:
            referenceName: Документ ITEXP_Инцидент TEST от 11.09.2017 15:04:43
            value: bec104b7-992b-11e7-8de5-000c29626b10
          ВерсияДанных:
            value: AAAAAAAC6HQ=
          Номер:
            value: TEST
          Дата:
            value: '2017-09-11T12:04:43Z'
          Проведен:
            value: true
          ВремяПростоя:
            value: 1
          ДатаОбнаружения:
            value: '2017-09-11T15:04:43Z'
          ДатаПрисвоенияСтатуса:
            value: '2018-04-09T05:41:12Z'
          Зарегистрировал:
            referenceName: Минтуш Олег Владимирович
            value: 3b1bb350-3ec2-11e7-ac1e-000c29626b10
          Инициатор:
            referenceName: Минтуш Олег Владимирович
            value: 3b1bb350-3ec2-11e7-ac1e-000c29626b10
          Исполнитель:
            referenceName: Минтуш Олег Владимирович
            value: 3b1bb350-3ec2-11e7-ac1e-000c29626b10
          КоличествоПереназначений:
            value: 1
          ЛинияПоддержки:
            referenceName: Линия 2
            value: a72e7f99-461c-11e7-ac1e-000c29626b10
          Описание:
            value: Это тестовый инцидент, созданный по шаблону 2
          ОтветственнаяФункциональнаяГруппа:
            referenceName: ФГ непрывность 1С
            value: 56a13917-9c63-11e7-8de5-000c29626b10
          Приоритет:
            referenceName: Плановый
            value: 0276ed2f-8dd2-11e7-9d32-000c29626b10
          ПричинаНазначения:
            value: '7'
          ПричинаЭскалации:
            referenceName: Изменить приоритет
            value: f4d3495a-b01d-11e7-974d-000c29626b10
          СпособОбращения:
            referenceName: Портал самообслуживания
            value: 0276ed30-8dd2-11e7-9d32-000c29626b10
          Статус:
            referenceName: Назначен
            value: 0276ed3a-8dd2-11e7-9d32-000c29626b10
          СтепеньВлияния:
            referenceName: Отсутствует
            value: 0276ed3e-8dd2-11e7-9d32-000c29626b10
          СтепеньДеградации:
            referenceName: Средняя
            value: 386c6e2a-8dd2-11e7-9d32-000c29626b10
          Тема:
            value: Автоматическое тестирование инцидентов7777
          ТребуетВнимания:
            value: true
          УровеньКритичности:
            referenceName: Средний
            value: 386c6e23-8dd2-11e7-9d32-000c29626b10

    GetMetadataResponse:
      type: object
      properties:
        primaryKey:
          type: string
          readOnly: true
        properties:
          type: object
          additionalProperties:
            $ref: '#/components/schemas/MetadataResponseProperty'
          readOnly: true
      example:
        primaryKey: Ссылка
        properties:
          Проведен:
            isNullable: true
            type: Boolean
          Ссылка:
            isNullable: true
            type: Reference
            args:
              reference: Документ.ITEXP_Инцидент
          ПометкаУдаления:
            isNullable: true
            type: Boolean
          Дата:
            isNullable: true
            type: DateTime
          Номер:
            isNullable: true
            type: String
          SLA:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Соглашения
          ВнешнийID:
            isNullable: true
            type: String
          ВремяПроверкиПользователем:
            isNullable: true
            type: Float
          ВремяПростоя:
            isNullable: true
            type: Float
          ДатаВосстановления:
            isNullable: true
            type: DateTime
          ДатаОбнаружения:
            isNullable: true
            type: DateTime
          ДатаОбнаруженияКЕИсточника:
            isNullable: true
            type: DateTime
          ДатаПодтвержденияВосстановления:
            isNullable: true
            type: DateTime
          ДатаПрисвоенияСтатуса:
            isNullable: true
            type: DateTime
          ДокументОснование:
            isNullable: true
            type: Union
            args:
              types:
              - type: Reference
                args:
                  reference: Документ.ITEXP_Обращение
              - type: Reference
                args:
                  reference: Документ.ITEXP_ЗапросНаОбслуживание
          ЗаметкиСпециалиста:
            isNullable: true
            type: String
          ЗаписьЗвонка:
            isNullable: true
            type: String
          Зарегистрировал:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Сотрудники
          ЗатраченноеВремя:
            isNullable: true
            type: Float
          Инициатор:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Сотрудники
          Исполнитель:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Сотрудники
          КатегорияПользователя:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_КатегорииПользователей
          КЕИсточник:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Заглушка
          КЕПроявления:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Заглушка
          КодЗакрытия:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_КодыЗакрытияИнцидентов
          КоличествоВозвратов:
            isNullable: true
            type: Float
          КоличествоПереназначений:
            isNullable: true
            type: Float
          КоэффициентПростоя:
            isNullable: true
            type: Float
          ЛинияПоддержки:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ЛинииПоддержки
          НомерОбращения:
            isNullable: true
            type: Reference
            args:
              reference: Документ.ITEXP_Обращение
          ОбщееВремяПроверкиПользователем:
            isNullable: true
            type: Float
          ОбщееВремяПростоя:
            isNullable: true
            type: Float
          ОперационнаяКатегория:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_КатегорииДействий
          Описание:
            isNullable: true
            type: String
          ОтветственнаяФункциональнаяГруппа:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ФункциональныеГруппы
          ОценкаАналитика:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ОценкиАналитика
          ОценкаПользователя:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ОценкиПользователя
          ПараметрыРаботыМетода:
            isNullable: true
            type: String
          Переклассификация:
            isNullable: true
            type: Reference
            args:
              reference: Документ.ITEXP_ЗапросНаОбслуживание
          ПлановаяДатаОкончанияОжидания:
            isNullable: true
            type: DateTime
          ПлановаяДатаРешения:
            isNullable: true
            type: DateTime
          ПоказательДоступности:
            isNullable: true
            type: Float
          ПоказательДоступностиСВлиянием:
            isNullable: true
            type: Float
          Пользователь:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Сотрудники
          Приоритет:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ПриоритетыИнцидентов
          ПричинаНазначения:
            isNullable: true
            type: String
          ПричинаОжидания:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ПричиныОжиданияВИнцидентах
          ПричинаЭскалации:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ПричиныЭскалацииИнцидента
          ПродуктоваяКатегория:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_КатегорииИТПродуктов
          РегламентнаяДатаРешения:
            isNullable: true
            type: DateTime
          Решение:
            isNullable: true
            type: String
          СозданнаяПроблема:
            isNullable: true
            type: Reference
            args:
              reference: Документ.ITEXP_Проблема
          СпособОбращения:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СпособыОбращения
          СпособУстранения:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СпособыУстраненияИнцидентов
          Статус:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СтатусыИнцидентов
          СтепеньВлияния:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СтепениВлиянияИнцидентов
          СтепеньДеградации:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СтепениДеградацииУслуг
          СтруктурноеПодразделениеПользователя:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_СтруктурныеПодразделения
          СхемаИнформирования:
            isNullable: true
            type: String
          СценарийВосстановления:
            isNullable: true
            type: Reference
            args:
              reference: Документ.ITEXP_СтатьяБазыЗнаний
          СценарийОбработки:
            isNullable: true
            type: String
          Тема:
            isNullable: true
            type: String
          ТребуетВнимания:
            isNullable: true
            type: Boolean
          УровеньКритичности:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_УровниКритичности
          Услуга:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Услуги
          УстранившаяЛинияПоддержки:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ЛинииПоддержки
          УстранившаяФункциональнаяГруппа:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ФункциональныеГруппы
          УстранившийИсполнитель:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_Сотрудники
          ЧасовойПояс:
            isNullable: true
            type: Reference
            args:
              reference: Справочник.ITEXP_ЧасовыеПояса
          ВерсияДанных:
            isNullable: true
            type: String
      
    PrimitiveValueResponse:
      type: object
      properties:
        value:
          format: int32
          type: integer
          readOnly: true
      example:
        value: 1